<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkbox and Select Box Options</title>
    <style>
        /* チェックボックスを横並びにするスタイル */
        .checkbox-container {
            display: flex;
            gap: 10px;  /* チェックボックスの間にスペースを追加 */
        }
    </style>
</head>
<body>

<!-- チェックボックスを横並びに配置 -->
<div class="checkbox-container">
    <label>
        <input type="checkbox" checked> Operational Data
    </label>
    <label>
        <input type="checkbox" checked> Abnormal Data
    </label>
    <label>
        <input type="checkbox" checked> Warning Data
    </label>
    <label>
        <input type="checkbox" checked> Batch Data
    </label>
</div>

<br><br>

<!-- セレクトボックス -->
<select class='variable-box' size="10">
    <option selected></option>
    <option class="operational-data">Operational Option 1</option>
    <option class="operational-data">Operational Option 2</option>
    <option class="abnormal-data">Abnormal Option 1</option>
    <option class="abnormal-data">Abnormal Option 2</option>
    <option class="warning-data">Warning Option 1</option>
    <option class="warning-data">Warning Option 2</option>
    <option class="batch-data">Batch Option 1</option>
    <option class="batch-data">Batch Option 2</option>
</select>

<script>
document.addEventListener('DOMContentLoaded', function() {

    // 初期設定関数
    function initCheckboxSelectInteraction(checkboxContainerSelector, selectBoxSelector, categoryClasses) {
        const checkboxContainer = document.querySelector(checkboxContainerSelector);
        const selectBox = document.querySelector(selectBoxSelector);
        const checkboxElements = checkboxContainer.querySelectorAll('input[type="checkbox"]');

        // セレクトボックス内の初期状態を保存
        const initialOptions = saveInitialOptions(selectBox);

        // チェックボックスと対応するカテゴリークラスを配列にマッピング
        const checkboxes = Array.from(checkboxElements).map((checkbox, index) => ({
            checkbox: checkbox,
            categoryClass: categoryClasses[index] // カテゴリークラスを直接マッピング
        }));

        // チェックボックスのリスナーを設定
        setupCheckboxListeners(checkboxes, selectBox, initialOptions);
    }

    // 初期状態のオプションを保存する関数
    function saveInitialOptions(selectBox) {
        return Array.from(selectBox.options).map(option => ({
            value: option.value,
            text: option.textContent,
            className: option.className
        }));
    }

    // オプションの順番を初期状態に保つための関数
    function restoreOptions(selectBox, initialOptions, activeGroups) {
        selectBox.innerHTML = ''; // 一旦全てクリア

        // activeGroupsに基づいて、初期オプションを順番に再追加
        initialOptions.forEach(option => {
            if (activeGroups.includes(option.className)) {
                const newOption = document.createElement('option');
                newOption.value = option.value;
                newOption.textContent = option.text;
                newOption.className = option.className;
                selectBox.appendChild(newOption);
            }
        });
    }

    // チェックボックスのイベントを設定する関数
    function setupCheckboxListeners(checkboxes, selectBox, initialOptions) {
        let activeGroups = checkboxes.map(({ checkbox, categoryClass }) => checkbox.checked ? categoryClass : null).filter(Boolean);

        checkboxes.forEach(({ checkbox, categoryClass }) => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // チェックがついた場合、アクティブグループに追加
                    if (!activeGroups.includes(categoryClass)) {
                        activeGroups.push(categoryClass);
                    }
                } else {
                    // チェックが外れた場合、アクティブグループから削除
                    const groupIndex = activeGroups.indexOf(categoryClass);
                    if (groupIndex !== -1) {
                        activeGroups.splice(groupIndex, 1);
                    }
                }

                // 初期状態に基づいてオプションを再構築して並べ替え
                restoreOptions(selectBox, initialOptions, activeGroups);
            });
        });
    }

    // カテゴリー名を定義
    const categoryClasses = [
        'operational-data', // Operational Data
        'abnormal-data',    // Abnormal Data
        'warning-data',     // Warning Data
        'batch-data'        // Batch Data
    ];

    // 初期化関数を呼び出す
    initCheckboxSelectInteraction('.checkbox-container', '.variable-box', categoryClasses);
});
</script>

</body>
</html>
